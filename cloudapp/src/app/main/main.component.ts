import { Component, OnInit, OnDestroy } from '@angular/core';
import { AlertService } from '@exlibris/exl-cloudapp-angular-lib';
import { RequestedResource, RequestedResources } from '../interfaces/requested-resources.interface';
import { RequestedResourcesService } from '../services/requested_resources.service';
import { CloudAppEventsService } from '@exlibris/exl-cloudapp-angular-lib';
import { UserInfoService } from '../services/user_info.service';
import { RequestInfoService } from '../services/request_info.service';

@Component({
  selector: 'app-main',
  templateUrl: './main.component.html',
  styleUrls: ['./main.component.scss']
})

export class MainComponent implements OnInit, OnDestroy {
  loading: boolean;
  noItemsMessage: string;
  today: number = Date.now();
  requestedResources: RequestedResources;
  currentlyAtLibCode: string;
  curentlyAtCircDeskCode: string;

  constructor(
    private alert: AlertService,
    private eventsService: CloudAppEventsService,
    private requestedResourcesService: RequestedResourcesService,
    private userInfoService: UserInfoService,
    private requestInfoService: RequestInfoService
  ) { }

  ngOnInit() {
    this.requestedResourcesService.isLoading().subscribe(
      loading => this.loading = loading
    );

    this.eventsService.getInitData().subscribe(
      data => {
        this.requestedResourcesService.getRequestedResources(data.user.currentlyAtLibCode,
          data.user['currentlyAtCircDesk'], 100, this.alert).subscribe(
            result => {
              this.requestedResources = {"requested_resource":[{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22440448940007861","link":"/almaws/v1/bibs/991020982999707861/holdings/22440448940007861"},"call_number":"BF575.H27 C851 1991","shelving_location":"shmoffs","copy":[{"pid":"23440448930007861","barcode":"31151030577260","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R05M01S01T16","link":"/almaws/v1/bibs/991020982999707861/holdings/22440448940007861/items/23440448930007861"}]},"resource_metadata":{"title":"Flow : the psychology of optimal experience / Mihaly Csikszentmihalyi.","author":"Csikszentmihalyi, Mihaly.","isbn":"0060920432","publisher":"HarperPerennial,","mms_id":{"value":"991020982999707861","link":"/almaws/v1/bibs/991020982999707861"},"publication_place":"New York, NY :","publication_year":"1991."},"request":[{"id":"14790042710007861","destination":{"value":"wwelch","desc":"William H. Welch Medical Library"},"requester":{"desc":"Minh Nguyet Nguyen","link":"/almaws/v1/users/97D5BD"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:29:33.153Z","link":"/almaws/v1/bibs/991020982999707861/requests/14790042710007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22400355080007861","link":"/almaws/v1/bibs/991031459019707861/holdings/22400355080007861"},"call_number":"DS141.K35 1954","shelving_location":"shmoffs","copy":[{"pid":"23400355070007861","barcode":"31151024497574","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"r06m02s27t05","link":"/almaws/v1/bibs/991031459019707861/holdings/22400355080007861/items/23400355070007861"}]},"resource_metadata":{"title":"Golah ṿe-nekhar : meḥkar hisṭori-sotsyologi bi-sheʻelat goralo shel ʻAm Yiśraʼel mi-yeme ḳedem ṿe-ʻad ha-zeman ha-zeh / me-et Yeḥezḳel Ḳoifman.","author":"Kaufmann, Yeḥezkel, 1889-1963.","publisher":"Devir,","mms_id":{"value":"991031459019707861","link":"/almaws/v1/bibs/991031459019707861"},"publication_place":"Tel-Aviv :","publication_year":"714 [1954]"},"request":[{"id":"14786665040007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Cameron Scott","link":"/almaws/v1/users/138F0A"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:05:38.400Z","link":"/almaws/v1/bibs/991031459019707861/requests/14786665040007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22419052220007861","link":"/almaws/v1/bibs/991036073839707861/holdings/22419052220007861"},"call_number":"G860.E53 2008","shelving_location":"shmofssh","copy":[{"pid":"23419052210007861","barcode":"31151028727802","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R02M04S27T08","link":"/almaws/v1/bibs/991036073839707861/holdings/22419052220007861/items/23419052210007861"}]},"resource_metadata":{"title":"Encounters at the end of the world / Discovery Films ; Image Entertainment ; ThinkFilm ; a film by Werner Herzog ; directed, written and narrated by Werner Herzog ; produced by Henry Kaiser ; executive producer, Erik Nelson ; produced by Creative Differences Productions, Inc. for the Discovery Channel.","publisher":"Discovery Communications,","mms_id":{"value":"991036073839707861","link":"/almaws/v1/bibs/991036073839707861"},"publication_place":"[Silver Spring, Maryland] :","publication_year":"[2008]"},"request":[{"id":"14790016580007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Steven Calleja","link":"/almaws/v1/users/14FE40"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:08:50.568Z","link":"/almaws/v1/bibs/991036073839707861/requests/14790016580007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22411603720007861","link":"/almaws/v1/bibs/991030376979707861/holdings/22411603720007861"},"call_number":"GE170.R447 2006","shelving_location":"shmoffs","copy":[{"pid":"23411603710007861","barcode":"31151025621438","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R03M10S06T03","link":"/almaws/v1/bibs/991030376979707861/holdings/22411603720007861/items/23411603710007861"}]},"resource_metadata":{"title":"The RFF reader in environmental and resource policy / Wallace E. Oates, editor.","isbn":"1933115173 (pbk. : alk. paper)","publisher":"Resources for the Future,","mms_id":{"value":"991030376979707861","link":"/almaws/v1/bibs/991030376979707861"},"publication_place":"Washington, DC :","publication_year":"c2006."},"request":[{"id":"14787729790007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"null MSEL Reserves: eres","link":"/almaws/v1/users/RESERVESERES"},"comment":"MSE RES: McGurty 420.643","printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:41:30.576Z","link":"/almaws/v1/bibs/991030376979707861/requests/14787729790007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22402178810007861","link":"/almaws/v1/bibs/991000272889707861/holdings/22402178810007861"},"call_number":"GN448.2 .G89 2016","shelving_location":"shmoffs","copy":[{"pid":"23402178800007861","barcode":"31151032851911","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R04M19S27T04","link":"/almaws/v1/bibs/991000272889707861/holdings/22402178810007861/items/23402178800007861"}]},"resource_metadata":{"title":"Legacies, logics, logistics : essays in the anthropology of the platform economy / Jane I. Guyer.","author":"Guyer, Jane I., author.","isbn":"022632687X","publisher":"The University of Chicago Press,","mms_id":{"value":"991000272889707861","link":"/almaws/v1/bibs/991000272889707861"},"publication_place":"Chicago :","publication_year":"2016."},"request":[{"id":"14790024920007861","destination":{"value":"wwelch","desc":"William H. Welch Medical Library"},"requester":{"desc":"Gabrielle Robbins","link":"/almaws/v1/users/2F12BD"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:12:37.500Z","link":"/almaws/v1/bibs/991000272889707861/requests/14790024920007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22409281690007861","link":"/almaws/v1/bibs/991013296319707861/holdings/22409281690007861"},"call_number":"GN656 .K86 1982","shelving_location":"shmoffs","copy":[{"pid":"23409281680007861","barcode":"31151031259538","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R04M31S23T03","link":"/almaws/v1/bibs/991013296319707861/holdings/22409281690007861/items/23409281680007861"}]},"resource_metadata":{"title":"Wives for cattle : bridewealth and marriage in Southern Africa / Adam Kuper.","author":"Kuper, Adam.","isbn":"0710009895 :","publisher":"Routledge & Kegan Paul,","mms_id":{"value":"991013296319707861","link":"/almaws/v1/bibs/991013296319707861"},"publication_place":"London ; Boston :","publication_year":"1982."},"request":[{"id":"14790031280007861","destination":{"value":"wwelch","desc":"William H. Welch Medical Library"},"requester":{"desc":"Gabrielle Robbins","link":"/almaws/v1/users/2F12BD"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:18:02.984Z","link":"/almaws/v1/bibs/991013296319707861/requests/14790031280007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22365820210007861","link":"/almaws/v1/bibs/991035572109707861/holdings/22365820210007861"},"call_number":"HM746.C48 2009","shelving_location":"shmoffs","copy":[{"pid":"23365820200007861","barcode":"31151028520256","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R04M22S23T05","link":"/almaws/v1/bibs/991035572109707861/holdings/22365820210007861/items/23365820200007861"}]},"resource_metadata":{"title":"Governance theory and practice : a cross-disciplinary approach / Vasudha Chhotray and Gerry Stoker.","author":"Chhotray, Vasudha, 1975-","isbn":"0230546765 (alk. paper)","publisher":"Palgrave Macmillan,","mms_id":{"value":"991035572109707861","link":"/almaws/v1/bibs/991035572109707861"},"publication_place":"Basingstoke [England] ; New York :","publication_year":"2009."},"request":[{"id":"14789994040007861","destination":{"value":"ShDC","desc":"Sheridan Library, DC"},"requester":{"desc":"Daniel Serwer","link":"/almaws/v1/users/6D6455"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:02:48.320Z","link":"/almaws/v1/bibs/991035572109707861/requests/14789994040007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22371429340007861","link":"/almaws/v1/bibs/991015512789707861/holdings/22371429340007861"},"call_number":"HQ 1236.5 .U6 W668 1997","shelving_location":"shmoffs","copy":[{"pid":"23371429330007861","barcode":"31151016014692","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R03M07S09T09","link":"/almaws/v1/bibs/991015512789707861/holdings/22371429340007861/items/23371429330007861"}]},"resource_metadata":{"title":"Women transforming politics : an alternative reader / edited by Cathy J. Cohen, Kathleen B. Jones, and Joan C. Tronto.","isbn":"0814715583 (paperbound : acid-free paper)","publisher":"New York University Press,","mms_id":{"value":"991015512789707861","link":"/almaws/v1/bibs/991015512789707861"},"publication_place":"New York :","publication_year":"c1997."},"request":[{"id":"14787637320007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Raychel Gadson","link":"/almaws/v1/users/7D3075"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:39:20.329Z","link":"/almaws/v1/bibs/991015512789707861/requests/14787637320007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22334507050007861","link":"/almaws/v1/bibs/991043158059707861/holdings/22334507050007861"},"call_number":"HT1219.V3 G71 1978","shelving_location":"shmoffs","copy":[{"pid":"23334507020007861","barcode":"31151038489203","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R04M05S07T09","link":"/almaws/v1/bibs/991043158059707861/holdings/22334507050007861/items/23334507020007861"}]},"resource_metadata":{"title":"La esclavitud en Valencia en los siglos XVI y XVII / [por] Vicente Graullera Sanz.","author":"Graullera Sanz, Vicente.","isbn":"8450025877 :","publisher":"Instituto Valenciano de Estudios Históricos, Institución Alfonso del Magnánimo, Diputación Provincial, Consejo Superior de Investigaciones Científicas,","mms_id":{"value":"991043158059707861","link":"/almaws/v1/bibs/991043158059707861"},"publication_place":"Valencia :","publication_year":"1978."},"request":[{"id":"14789894620007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Marco Pomini","link":"/almaws/v1/users/59BE63"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:59:43.672Z","link":"/almaws/v1/bibs/991043158059707861/requests/14789894620007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22343880730007861","link":"/almaws/v1/bibs/991024858369707861/holdings/22343880730007861"},"call_number":"JK274 .K555 2003","shelving_location":"shmoffs","copy":[{"pid":"23343880720007861","barcode":"30176101171066","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R23M14S28T13","link":"/almaws/v1/bibs/991024858369707861/holdings/22343880730007861/items/23343880720007861"}]},"resource_metadata":{"title":"Agendas, alternatives, and public policies / John W. Kingdon ; with new foreword by James A. Thurber.","author":"Kingdon, John W.","isbn":"0321121856","publisher":"Longman,","mms_id":{"value":"991024858369707861","link":"/almaws/v1/bibs/991024858369707861"},"publication_place":"New York :","publication_year":"c2003."},"request":[{"id":"14788330790007861","destination":{"value":"wwelch","desc":"William H. Welch Medical Library"},"requester":{"desc":"Emani Kelley","link":"/almaws/v1/users/141199"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:48:09.374Z","link":"/almaws/v1/bibs/991024858369707861/requests/14788330790007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22412291620007861","link":"/almaws/v1/bibs/991037025639707861/holdings/22412291620007861"},"call_number":"ML3565.M66 2010","shelving_location":"shmoffs","copy":[{"pid":"23412291590007861","barcode":"31151028981755","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R01M25S02T14","link":"/almaws/v1/bibs/991037025639707861/holdings/22412291620007861/items/23412291590007861"}]},"resource_metadata":{"title":"Music in the Hispanic Caribbean : experiencing music, expressing culture / Robin Moore.","author":"Moore, Robin, 1964-","isbn":"0195375068 (hardback)","publisher":"Oxford University Press,","mms_id":{"value":"991037025639707861","link":"/almaws/v1/bibs/991037025639707861"},"publication_place":"New York :","publication_year":"2010."},"request":[{"id":"14787093380007861","destination":{"value":"OFFICE","desc":"Office Delivery"},"requester":{"desc":"Lawrence Jackson","link":"/almaws/v1/users/9962AD"},"comment":"Gilman English Dept Jackson","printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:33:07.018Z","link":"/almaws/v1/bibs/991037025639707861/requests/14787093380007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22459967080007861","link":"/almaws/v1/bibs/991037080669707861/holdings/22459967080007861"},"call_number":"N6537 .K363 A4 2009 QUARTO","shelving_location":"shmoffs","copy":[{"pid":"23459967060007861","barcode":"31151028977746","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R05M27S14T01","link":"/almaws/v1/bibs/991037080669707861/holdings/22459967080007861/items/23459967060007861"}]},"resource_metadata":{"title":"Mike Kelley : educational complex onwards 1995-2008 / curated by Anne Pontégnie.","author":"Kelley, Mike, 1954-2012.","isbn":"3905829800","publisher":"JRP/Ringier,","mms_id":{"value":"991037080669707861","link":"/almaws/v1/bibs/991037080669707861"},"publication_place":"Zurich :","publication_year":"c2009."},"request":[{"id":"14790243380007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Alara Kaplanoglu","link":"/almaws/v1/users/40620B"},"printed":false,"reported":false,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T16:23:43.823Z","link":"/almaws/v1/bibs/991037080669707861/requests/14790243380007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22342547650007861","link":"/almaws/v1/bibs/991008480879707861/holdings/22342547650007861"},"call_number":"NX512.K46 L67 2020","shelving_location":"shmoffs","copy":[{"pid":"23342547640007861","barcode":"31151035755507","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R06M38S01T16","link":"/almaws/v1/bibs/991008480879707861/holdings/22342547650007861/items/23342547640007861"}]},"resource_metadata":{"title":"Mike Kelley : materialist aesthetics and memory illusions / Laura López Paniagua ; with an introduction by John Miller.","author":"López Paniagua, Laura, author.","isbn":"8867494163","publisher":"Mousse Publishing,","mms_id":{"value":"991008480879707861","link":"/almaws/v1/bibs/991008480879707861"},"publication_place":"Milan, Italy :","publication_year":"2020."},"request":[{"id":"14790243840007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Alara Kaplanoglu","link":"/almaws/v1/users/40620B"},"printed":false,"reported":false,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T16:23:55.817Z","link":"/almaws/v1/bibs/991008480879707861/requests/14790243840007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22430607460007861","link":"/almaws/v1/bibs/991013055979707861/holdings/22430607460007861"},"call_number":"PO2852.A2 S5","shelving_location":"shmoffs","copy":[{"pid":"23430607450007861","barcode":"31151025388285","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"r10m03s05t12","link":"/almaws/v1/bibs/991013055979707861/holdings/22430607460007861/items/23430607450007861"}]},"resource_metadata":{"title":"A supplement to the plays of William Shakespeare: comprising the seven dramas, which have been ascribed to his pen, but which are not included with his writings in modern editions, namely: The two noble kinsmen, The London prodigal, Thomas Lord Cromwell, Sir John Oldcastle, The puritan, or the widow of Watling street, The Yorkshire tragedy, The tragedy of Locrine. Edited, with notes, and an introduction to each play, by William Gilmore Simms...","author":"Shakespeare, William, 1564-1616.","publisher":"G F Cooledge & brother,","mms_id":{"value":"991013055979707861","link":"/almaws/v1/bibs/991013055979707861"},"publication_place":"New York,","publication_year":"1848."},"request":[{"id":"14787718120007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Gabrielle Dean","link":"/almaws/v1/users/PSZHK6"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:41:54.308Z","link":"/almaws/v1/bibs/991013055979707861/requests/14787718120007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22445925110007861","link":"/almaws/v1/bibs/991022213589707861/holdings/22445925110007861"},"call_number":"PR3489.4 .Z6 A6 1987","shelving_location":"shmoffs","copy":[{"pid":"23445925100007861","barcode":"31151034534994","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R06M23S21T11","link":"/almaws/v1/bibs/991022213589707861/holdings/22445925110007861/items/23445925100007861"}]},"resource_metadata":{"title":"An arrow in the wall : selected poetry and prose / Andrei Voznesensky ; edited by William Jay Smith and F.D. Reeve ; poems translated by W.H. Auden ... [et al.] ; prose translated by Antonina W. Bouis.","author":"Voznesenskiĭ, Andreĭ, 1933-2010.","isbn":"080500100X","publisher":"H Holt,","mms_id":{"value":"991022213589707861","link":"/almaws/v1/bibs/991022213589707861"},"publication_place":"New York :","publication_year":"c1987."},"request":[{"id":"14788962030007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Peter Schmelz","link":"/almaws/v1/users/EE9FDE"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:52:43.160Z","link":"/almaws/v1/bibs/991022213589707861/requests/14788962030007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22338972030007861","link":"/almaws/v1/bibs/991025000899707861/holdings/22338972030007861"},"call_number":"PR3489.4.Z6 A221 1967","shelving_location":"shmoffs","copy":[{"pid":"23338972020007861","barcode":"31151011602012","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R11M29S03T09","link":"/almaws/v1/bibs/991025000899707861/holdings/22338972030007861/items/23338972020007861"}]},"resource_metadata":{"title":"Antiworlds, and The fifth ace; poetry, by Andrei Voznesensky. Translated by W. H. Auden [and others] Edited by Patricia Blake and Max Hayward, with a foreword by W. H. Auden.","author":"Voznesenskiĭ, Andreĭ, 1933-2010.","publisher":"Basic Books","mms_id":{"value":"991025000899707861","link":"/almaws/v1/bibs/991025000899707861"},"publication_place":"New York,","publication_year":"[1967]"},"request":[{"id":"14788652180007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Peter Schmelz","link":"/almaws/v1/users/EE9FDE"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T14:52:10.496Z","link":"/almaws/v1/bibs/991025000899707861/requests/14788652180007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22353612070007861","link":"/almaws/v1/bibs/991018092719707861/holdings/22353612070007861"},"call_number":"QD455.3.M3 M67 1999","shelving_location":"shmofssh","copy":[{"pid":"23353612060007861","barcode":"31151018915730","base_status":{"value":"1","desc":"Item in place"},"alternative_call_number":"","storage_location_id":"R04M35S08T06","link":"/almaws/v1/bibs/991018092719707861/holdings/22353612070007861/items/23353612060007861"}]},"resource_metadata":{"title":"Mathematics for physical chemistry / Robert G. Mortimer.","author":"Mortimer, Robert G.","isbn":"0125083408","publisher":"Harcourt/Academic Press,","mms_id":{"value":"991018092719707861","link":"/almaws/v1/bibs/991018092719707861"},"publication_place":"San Diego, Calif. :","publication_year":"c1999."},"request":[{"id":"14790171240007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Burak Tufekci","link":"/almaws/v1/users/E9B1C0"},"printed":false,"reported":false,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T16:03:40.511Z","link":"/almaws/v1/bibs/991018092719707861/requests/14790171240007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22639262270007861","link":"/almaws/v1/bibs/991029317099707861/holdings/22639262270007861"},"call_number":"RC961.5 .T741 1978","shelving_location":"shmoffs","copy":[]},"resource_metadata":{"title":"Tropical medicine and parasitology : classic investigations / edited by B. H. Kean, Kenneth E. Mott, and Adair J. Russell.","isbn":"0801409926","publisher":"Cornell University Press,","mms_id":{"value":"991029317099707861","link":"/almaws/v1/bibs/991029317099707861"},"publication_place":"Ithaca, N.Y. :","publication_year":"1978."},"request":[{"id":"14569762560007861","destination":{"value":"OFFICE","desc":"Office Delivery"},"requester":{"desc":"Jonathan Flombaum","link":"/almaws/v1/users/HJUWN3"},"comment":"Ames Hall, Department Mailbox","printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-25Z","request_time":"2023-10-25T17:57:20.212Z","link":"/almaws/v1/bibs/991029317099707861/requests/14569762560007861"}]},{"location":{"library":{"value":"LSC","desc":"Offsite Storage"},"holding_id":{"value":"22638884370007861","link":"/almaws/v1/bibs/991001667629707861/holdings/22638884370007861"},"call_number":"RS180.C5 L4513 2003b","shelving_location":"shmoffs","copy":[]},"resource_metadata":{"title":"Compendium of materia medica : Bencao gangmu / compiled by Li Shizhen ; translated and annotated by Luo Xiwen.","author":"Li, Shizhen, 1518-1593.","isbn":"9787119032603","publisher":"Foreign Languages Press,","mms_id":{"value":"991001667629707861","link":"/almaws/v1/bibs/991001667629707861"},"publication_place":"Beijing :","publication_year":"2003."},"request":[{"id":"14790020550007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Jamie Little","link":"/almaws/v1/users/7847FA"},"comment":"A test from Jamie Little. Please ignore.","printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-30Z","request_time":"2023-10-30T15:11:16.742Z","link":"/almaws/v1/bibs/991001667629707861/requests/14790020550007861"},{"id":"14743764470007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Wesley Sampias","link":"/almaws/v1/users/6D6261"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-29Z","request_time":"2023-10-29T03:25:19.821Z","link":"/almaws/v1/bibs/991001667629707861/requests/14743764470007861"},{"id":"14743764390007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Wesley Sampias","link":"/almaws/v1/users/6D6261"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-29Z","request_time":"2023-10-29T03:24:58.338Z","link":"/almaws/v1/bibs/991001667629707861/requests/14743764390007861"},{"id":"14743764530007861","destination":{"value":"ShMSEL","desc":"Milton S. Eisenhower Library"},"requester":{"desc":"Wesley Sampias","link":"/almaws/v1/users/6D6261"},"printed":false,"reported":true,"request_type":"HOLD","request_sub_type":{"value":"PATRON_PHYSICAL","desc":"Patron physical item request"},"request_date":"2023-10-29Z","request_time":"2023-10-29T03:25:31.897Z","link":"/almaws/v1/bibs/991001667629707861/requests/14743764530007861"}]}],"total_record_count":19}

              this.requestedResources.requested_resource.forEach(resource => {
                console.log('Resource:', resource)
                this.addRequestInfoToRequestedResource(resource);
                this.addEmailToRequestedResource(resource);
              });
            }
          );
      }
    );
  }

  addRequestInfoToRequestedResource(resource: RequestedResource) {
    resource.request.forEach(request => {
      if (request.link) {
        this.requestInfoService.getRequestInfo(request.link, this.alert).subscribe(result => {
          console.log('Request Info: ', result);
          this.requestedResources.requested_resource.forEach(() => {
            request.description = result.description
            console.log(request)
          });
        });
      }
    });
  }

  addEmailToRequestedResource(resource: RequestedResource) {
    resource.request.forEach(request => {
      if (request.requester.link) {
        this.userInfoService.getUserInfo(request.requester.link, this.alert).subscribe(result => {
          this.requestedResources.requested_resource.forEach(() => {
            request.email = result.contact_info.email
              .map(contact => contact.email_address)
              .join(', ');
          });
        });
      }
    });
  }

  getVisibleResources(): RequestedResource[] {
    return this.requestedResources.requested_resource
  }

  getTotalVisible(): number {
    return this.getVisibleResources().length;
  }

  hideResource(index: number): void {
    const filteredAndSortedResources = this.getVisibleResources();
    if (filteredAndSortedResources[index]) {
      const resourceId = filteredAndSortedResources[index].location.holding_id.value;
      this.requestedResources.requested_resource = this.requestedResources.requested_resource.filter(resource => resource.location.holding_id.value !== resourceId);
    }
  }

  ngOnDestroy(): void {
  }
}
